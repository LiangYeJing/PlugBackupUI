# PlugBackup — 自动化本地/移动硬盘备份工具

> 一个基于 **Qt/C++** 的跨平台开源小工具，解决“**插上移动硬盘就自动备份**、**去重**、**校验**、**版本留存**、**删除留存与一键恢复**”等痛点。
>  现阶段侧重个人与小团队使用；也非常适合作为 **公司内网文件共享/归档的基础能力**。

## ✨ 主要特性

- **一键选择多源目录 + 一个目标目录（常为移动硬盘/网盘挂载/NAS 共享）**
  - 防呆校验：目标不可在源目录内、目标需可写、源目录互不包含等。
- **自动触发策略**
  - **定时备份**（间隔分钟可配）
  - **“文件正常关闭”后备份**（可配置稳定时间窗，避免边写边备份）
  - **设备在线检测**（每 X 分钟检查，在线即自动续传）
- **智能模式（可选）**：系统繁忙则自动暂停，空闲自动恢复（CPU 阈值 + 轮询间隔可配）
- **去重与内容校验**
  - 按内容哈希去重（相同文件仅存一份）
  - 拷贝后二次校验；失败自动重试；半截文件用 `.part` 扩展名临时存放，失败会清理
- **版本/删除留存与恢复**
  - 修改前会将旧版本放入 `.plugbackup_meta/versions`
  - 删除的文件放入 `.plugbackup_meta/deleted`
  - UI 内可**一键恢复**到源位置；也可在目标侧保留一份
  - **保留天数**可配置，达到天数自动清理陈旧版本
- **忽略规则（glob）**：如 `*.tmp; node_modules/*; *.log`
- **限速**：按 **MB/s** 可选限速，保护前台使用体验
- **进度面板**：显示每个源目录的**速率、ETA、状态**，并可**暂停/继续/取消**单行任务
- **断盘保护**：检测到设备离线会暂停并**非模态弹窗提示**，回插后自动继续

> 当前支持 Windows（已测 MinGW），理论支持 macOS/Linux（Qt6 Widgets）。

------

## 🖼️ 界面概览

- 顶部：全局速率与剩余时间
- 源/目标选择、忽略规则
- 自动化策略 & 高级设置（保留天数/限速/智能模式）
- 任务表（进度/速率/ETA/状态/操作）
- 失败文件重试
- 历史版本与删除留存，支持扫描与一键恢复


------

## 🚀 快速开始

### 方式 A：Qt Creator

1. 用 Qt Creator 打开工程（CMake 项目）
2. 选择 Qt6 Kit（建议 **Qt 6.2+**）
3. 构建并运行

### 方式 B：命令行

```
# 以 Windows 为例，确保安装了 Qt 6.x 与 CMake >= 3.16
cmake -S . -B build -DCMAKE_PREFIX_PATH="C:/Qt/6.9.2/mingw_64"  # 按你的路径
cmake --build build -j
# 可执行文件位于 build/ 下
```

------

## 🛠️ 使用说明

1. 在“源目录列表”添加 1 个或多个源目录；在“备份目标目录”选择移动硬盘（或 NAS/网络盘挂载路径）
2. 配置忽略规则、自动化策略（定时/稳定窗口/设备检测）、高级设置（保留天数/限速/智能模式）
3. 点击“开始备份”或等待自动触发
4. 若中途断盘会提示，回插后会自动续传
5. 历史版本/删除留存在“历史版本 与 删除留存”面板扫描后即可**选择条目并一键恢复**

> **注意**：请勿将“目标目录”设置在任何“源目录”内部，避免递归备份。

------

## 📁 目录结构（目标盘）

```
<目标根>/
  ├─ <源目录1>/
  ├─ <源目录2>/
  └─ .plugbackup_meta/
       ├─ versions/    # 历史版本（按 hash 或路径组织）
       └─ deleted/     # 删除留存
         （每个数据文件旁会有 .json 元数据，记录 origAbs/rel/srcRoot 等）
```

------

## 🧪 安全性与一致性

- 复制采用**临时 .part 文件**，校验通过再原子替换为最终文件名
- 校验失败会清理 `.part` 并重试，不会留下半截垃圾
- 目标盘离线时**不会写入**（Worker 会暂停并上报离线）

------

## 🧩 构建/运行依赖

- C++17
- Qt 6.x（Core / Gui / Widgets）
- CMake ≥ 3.16
- Windows（MinGW/MSVC）、Linux、macOS（待验证）

------

## 🧭 发展路线（Roadmap）

> 欢迎按以下方向提交 Issue/PR，一起把它打磨成**公司内外都好用**的开源工具。

- **团队/企业场景**
  - 支持 **SMB/NFS/NAS** 的目标侧优化与断点续传策略
  - **团队空间**：共享索引与权限（只读/可恢复），可审计操作日志
  - **跨用户去重**：全局内容寻址（hash）降低团队存储成本
  - **离线索引快照**：管理员可导出“备份清单”CSV/HTML 以审计
- **服务化/平台化**
  - 后台 **守护进程/服务** + **托盘 UI**
  - **Web 控制台**：多客户端可视化进度、告警、统计
  - CLI（命令行）与 JSON-RPC / gRPC 控制接口
- **高级数据面向**
  - 内容分块（CDC/固定块）与**对象存储**（S3/OSS/OBS/MinIO）适配
  - **端到端加密**（可选零知识）：目标端落地为加密对象
  - 更丰富的**排除/包含策略**（正则/标签/大小/修改时间）
  - 冲突与锁：并发写入的版本分叉/合并策略
- **体验/工程**
  - 深色主题、国际化（已有 `tr()`）与可折叠面板
  - 安装包（Windows MSI/Inno、macOS .dmg、Linux AppImage）
  - 单元测试 & 集成测试（Fake FS / Temp dir）

------

## 🤝 贡献指南

- 提交 **Issue** 说明场景与重现步骤
- Fork 后 **新建分支** 开发：`feature/<topic>` / `fix/<topic>`
- **Commit 信息规范**（建议）：`feat: ...` / `fix: ...` / `refactor: ...` / `docs: ...`
- 提交 **PR** 前请：
  1. 本地能构建通过（Windows + Qt6 至少验证一个）
  2. 遵循已有代码风格（ClangFormat/Clang-Tidy 可选）
  3. 说明变更点、风险点与测试方法
- 行为规范：彼此尊重，理性讨论

------

## 📄 许可协议

（请在确定后选择协议：**MIT** / **Apache-2.0** / **GPLv3** …）
 *示例*：本项目采用 **MIT License**（见 `LICENSE`）。

------

## 🙌 致谢

感谢所有使用与反馈的朋友，欢迎 Star、Issue 与 PR！
 若你在公司内部落地，也欢迎分享实践经验与最佳实践。
